version: v2beta1
name: plugin-server-discovery-velocity

deployments:
  app:
    namespace: games
    helm:
      releaseName: plugin-server-discovery-velocity
      chart:
        name: oci://ghcr.io/groundsgg/charts/grounds-service
        version: 0.1.0
      values:
        deployment:
          image:
            repository: velocity
          containerPort: 25565
          env:
            - name: VELOCITY_FORWARDING_SECRET
              value: "123456789"
            - name: VALKEY_HOST
              value: "valkey-headless.databases"
            - name: VALKEY_PORT
              value: "6379"
        service:
          enabled: true
          port: 25565
          targetPort: 25565

dev:
  app:
    # Search for the container that runs this image
    imageSelector: velocity
    # Replace the container image with this image
    devImage: ghcr.io/groundsgg/velocity:0.3.0
    sync:
      - path: ./build/libs/*.jar:/app/plugins/*.jar
        file: true
    # Open a terminal and use the following command to start it
    terminal:
      command: |
        echo "Use ./start.sh to start the server"
        /bin/sh
    # Forward the following ports to be able to access your application via localhost
    ports:
      - port: "25565"
